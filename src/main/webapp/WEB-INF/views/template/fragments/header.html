<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="www.thymeleaf.org"
      th:fragment="HeaderFragment">

<head>
<meta name="_csrf" th:content="${_csrf.token}"/>
<meta name="_csrf_header" th:content="${_csrf.headerName}"/>

  <title></title>
  
  <style>
    header {
      width: 100%;
      background: linear-gradient(to right, #4a90e2, #0077c8);
      padding: 16px 20px;
      color: #ffffff;
      box-sizing: border-box;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-family: 'Segoe UI', Roboto, sans-serif;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
    }

    .logo {
      font-size: 22px;
      font-weight: bold;
    }

    nav a {
      color: white;
      text-decoration: none;
      margin-left: 16px;
      font-size: 15px;
      font-weight: 500;
    }

    nav a:hover {
      opacity: 0.8;
    }
  </style>
</head>

<body>

<th:block th:fragment="script">
  <!-- <th:block th:insert="template/fragments/csrf :: csrfFragment" />  -->
  
  <script type="text/javascript">
    const headerScript = (function () {
      function init() {
        fnAddEvent();
      }
      
      
      var obj = {
    		  url : '/logout.do'
    		  ,data : ''
    		  //,dataType : ''
    		  ,method : 'POST'
      };

      function fnAddEvent() {
        $('#logout').on('click', fnLogout);
      }

      function fnLogout(event) {
        event.preventDefault();
/*
        //í¼ë°ì´í„° / { "_csrf": "í† í°ê°’" }
        //const paramName = "[[${csrfParamName}]]";
        //const postData = {};
        //postData[paramName] = token;

        //í—¤ë” / X-CSRF-TOKEN : "í† í°ê°’"
        const paramName = "X-CSRF-TOKEN"; //í—¤ë”ì— ë„£ì„ì‹œ

*/
/*
        const token = CSRF_TOKEN;
        const paramName = CSRF_HEADER_NAME;
        console.log("token : ", token);
        console.log("paramName : ", paramName);
*/        
        //AjaxUtil.ajaxPostJson('/logout.do', {},
        AjaxUtil.fnAjax(obj,
                // âœ… ì„±ê³µ ì½œë°± í•¨ìˆ˜
                function(response) {
                    console.log('ê²Œì‹œë¬¼ ë“±ë¡ ì„±ê³µ:', response);
                    alert('ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    // ì„±ê³µ í›„ ëª©ë¡ í˜ì´ì§€ë¡œ ì´ë™ ë˜ëŠ” í™”ë©´ ê°±ì‹ 
                    window.location.href = '/'; 
                },
                // âŒ ì—ëŸ¬ ì½œë°± í•¨ìˆ˜
                function(xhr, status, error) {
                    console.error('ë“±ë¡ ì‹¤íŒ¨ ìƒì„¸:', xhr.responseText);
                    alert('ë¡œê·¸ì•„ì›ƒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.');
                }
            );
/*
        $.ajax({
          url: '/logout.do',
          type: 'POST',
          //headers: {
          //  [paramName]: token // í—¤ë” ì „ì†¡ì‹œ
          //},
          //data: postData, // í¼ë°ì´í„° ì „ì†¡ì‹œ
          success: function (response) {
            console.log("ë¡œê·¸ì•„ì›ƒ ì„±ê³µ:", response);
            window.location.href = '/';
          },
          error: function (xhr, status, error) {
            console.error("ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨:", error);
            alert("ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            window.location.href = '/';
          }
        });
*/
      }

      return {
        init: init
      };
    })();

    $(function() {
      // #logout ìš”ì†Œê°€ ìˆê³ , CSRF í† í° ë³€ìˆ˜ê°€ ìˆì„ ë•Œë§Œ ì´ˆê¸°í™”
      if ($('#logout').length) {
        headerScript.init();
      }
    });

  </script>
</th:block>

<header th:fragment="HeaderFragment">
  <div class="logo">
    ğŸŒ MY HICO
  </div>

  <nav>
    <a href="/">í™ˆ</a>
    <a href="/board.do">ê²Œì‹œíŒ</a>
    <a href="/test/page.do">ì„œë¹„ìŠ¤</a>
    <a href="#">ê³ ê°ì„¼í„°</a>
    <a sec:authorize="isAnonymous()" href="/login/loginForm.do">ë¡œê·¸ì¸</a>
    <a sec:authorize="isAuthenticated()" href="#" id="logout" class="logout-link">ë¡œê·¸ì•„ì›ƒ</a>
    <a sec:authorize="hasRole('ADMIN')" href="/admin/test/list.do">ê´€ë¦¬ì</a>
  </nav>
<!--
  <div sec:authorize="isAuthenticated()">
    <form id="logoutFormHeader" action="/logout.do" method="post" style="display: none;">
      <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
    </form>
  </div>
  -->
</header>
</body>

</html>
