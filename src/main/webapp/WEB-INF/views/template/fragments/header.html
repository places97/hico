<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="www.thymeleaf.org"
      th:fragment="HeaderFragment">

<head>
  <title></title>
  <style>
    header {
      width: 100%;
      background: linear-gradient(to right, #4a90e2, #0077c8);
      padding: 16px 20px;
      color: #ffffff;
      box-sizing: border-box;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-family: 'Segoe UI', Roboto, sans-serif;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
    }

    .logo {
      font-size: 22px;
      font-weight: bold;
    }

    nav a {
      color: white;
      text-decoration: none;
      margin-left: 16px;
      font-size: 15px;
      font-weight: 500;
    }

    nav a:hover {
      opacity: 0.8;
    }
  </style>

</head>

<body>

<th:block th:fragment="script">
  <!-- ğŸ’¡ _csrf ê°ì²´ê°€ ë„ì´ ì•„ë‹ ë•Œë§Œ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ -->
  <script th:if="${_csrf != null}" type="text/javascript">
    $(document).ready(function () {
      $('#logout').on('click', function(event) {
        event.preventDefault(); // ê¸°ë³¸ ë§í¬ ë™ì‘ ë°©ì§€
        $('#logoutFormHeader').submit();
      });
    });
  </script>

  <script type="text/javascript">
    $(document).ready(function () {
      fnAddEvent();
    });

    function fnAddEvent() {
      $('#logout').on('click', fnLogout);
    }

    // ğŸ’¡ ë¡œê·¸ì•„ì›ƒ í•¨ìˆ˜ êµ¬í˜„
    function fnLogout(event) {
      event.preventDefault(); // ê¸°ë³¸ ì´ë²¤íŠ¸(ë§í¬ ì´ë™ ë“±) ë°©ì§€

      var $logoutForm = $('#logoutForm');

      // ğŸ’¡ ë¡œê·¸ì•„ì›ƒ í¼ì— CSRF í† í° ë™ì  ì¶”ê°€
      // Thymeleaf ë³€ìˆ˜ê°€ window ê°ì²´ì— ì €ì¥ë˜ì–´ ìˆì„ ê²½ìš°ì—ë§Œ ì‹¤í–‰
      if (window.csrfParameterName && window.csrfToken) {
        // ìˆ¨ê²¨ì§„ input í•„ë“œë¥¼ í¼ì— ì¶”ê°€
        $logoutForm.append('<input type="hidden" name="' + window.csrfParameterName + '" value="' + window.csrfToken + '" />');
      }

      // í¼ ì œì¶œ ë¡œì§
      $logoutForm.submit();
    }

  </script>
</th:block>

<header th:fragment="HeaderFragment">
  <div class="logo">
    ğŸŒ MY HICO
  </div>

  <nav>
    <a href="/home.do">í™ˆ</a>
    <a href="/test/page.do">ì„œë¹„ìŠ¤</a>
    <a href="#">ê³ ê°ì„¼í„°</a>
    <!-- ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ë§í¬ ìˆ˜ì • -->
    <a sec:authorize="isAnonymous()" href="/login/loginForm.do">ë¡œê·¸ì¸</a>

    <!-- ğŸ’¡ IDë¥¼ ì¶”ê°€í•˜ì—¬ JSì—ì„œ ì´ë²¤íŠ¸ ë°”ì¸ë”© -->
    <a sec:authorize="isAuthenticated()" href="#" id="logout" class="logout-link">ë¡œê·¸ì•„ì›ƒ</a>

    <a sec:authorize="hasRole('ADMIN')" href="/admin/test/list.do">ê´€ë¦¬ì</a>
  </nav>

  <div sec:authorize="isAuthenticated()">
    <form id="logoutFormHeader" action="/logout.do" method="post" style="display: none;">
      <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
    </form>
  </div>
</header>
</body>

</html>
