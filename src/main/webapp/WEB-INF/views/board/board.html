<!DOCTYPE html>
<html lang="ko"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{template/layout/layout}">
<head>
  <title>게시판 테스트</title>
</head>

<body>
<main layout:fragment="Content">
  <h1>게시판</h1>

  <div class="container">
    <div style="margin-bottom: 10px;">
      <label for="board-select">게시판 선택:</label>
      <select id="board-select">
        <option
            th:each="board : ${boardList}"
            th:value="${board.boardId}"
            th:text="${board.boardName}">
          게시판 이름
        </option>
      </select>
    </div>

    <button id="select-button" onclick="">목록 조회</button>

    <table id="board-table">
      <thead>
      <tr>
        <th>ID</th>
        <th>제목</th>
        <th>작성자</th>
        <th>조회수</th>
        <th>작성일</th>
        <th>수정일</th>
        <th>삭제여부</th>
      </tr>
      </thead>
      <tbody id="post-list-body">
      </tbody>
    </table>
  </div>
</main>

<th:block layout:fragment="script">
  <!-- JSRender Template -->
  <script id="dataRowTmpl" type="text/x-jsrender">
    <tr onclick="fnGoToPostDetail({{: postId}})">
      <td>{{: postId}}</td>
      <td>{{: title}}</td>
      <td>{{: writerName}}</td>
      <td>{{: viewCount}}</td>
      <td>{{: createdAt}}</td>
      <td>{{: updatedAt}}</td>
      <td>{{: delYn}}</td>
    </tr>
  </script>

  <script type="text/javascript">
    $(document).ready(function () {
      fnAddEvent();
    });

    function fnAddEvent() {
      $('#select-button').on('click', fnPostList);
    }

    function fnPostList() {
      const selectedBoardId = $('#board-select').val();
      console.log(selectedBoardId, "::: selectedBoardId")

      $.ajax({
        url: '/post/list.do',
        type: 'GET',
        dataType: 'json',
        contentType: 'application/json; charset=utf-8',
        data: {boardId: selectedBoardId},
        success: function (response) {
          const dataList = response.data;
          fnRenderPostList(dataList);
        },
        error: function (response) {
          // JSON 파싱 오류를 방지하기 위해 response.responseText가 있는지 확인합니다.
          let errorResultVo;
          try {
            errorResultVo = JSON.parse(response.responseText);
            alert("에러 발생: " + errorResultVo.resMsg);
          } catch (e) {
            alert("예상치 못한 형식의 에러 발생. 서버 로그를 확인하세요.");
            console.error(response);
          }
        }
      })
    }

    function fnRenderPostList(dataList) {
      let $tbody = $('#post-list-body');
      $tbody.empty();

      if (dataList?.length > 0) {
        let template = $.templates("#dataRowTmpl");
        let htmlOutput = template.render(dataList);
        $tbody.append(htmlOutput);
      } else {
        $tbody.append(`<td colspan="7" class="no-data">선택하신 카테고리에 해당하는 게시글이 없습니다.</td>`)
      }
    }

    function fnGoToPostDetail(postId) {
      window.location.href = `/post/detail.do?id=${postId}`;
    }
  </script>
</th:block>
</body>
</html>

<style>
  main {
    font-family: Arial, sans-serif;
  }

  .container {
    width: 90%;
    margin: 20px auto;
  }

  /* 버튼 스타일 */
  #select-button {
    padding: 8px 15px;
    background-color: #007bff; /* 파란색 계열 */
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    margin-bottom: 20px;
    font-weight: bold;
  }

  /* 테이블 기본 스타일 */
  #board-table {
    width: 100%; /* 테이블 너비 100% */
    border-collapse: collapse; /* 경계선 합치기 */
    font-size: 14px;
  }

  /* 헤더 스타일 */
  #board-table thead th {
    background-color: #f1f1f1; /* 연한 회색 배경 */
    color: #333;
    border: 1px solid #ddd;
    padding: 10px;
    text-align: center;
    font-weight: bold;
  }

  /* 본문 셀 스타일 */
  #board-table tbody td {
    border: 1px solid #ddd;
    padding: 10px;
    text-align: center;
  }

  /* 데이터 없음 스타일 */
  #board-table tbody .no-data {
    text-align: center;
    font-style: italic;
    color: #777;
    padding: 20px;
    background-color: #fafafa;
  }

  /* 짝수 행 배경색 (가독성 향상) */
  #board-table tbody tr:nth-child(even) {
    background-color: #f9f9f9;
  }

  /* 마우스 오버 시 하이라이트 */
  #board-table tbody tr:hover {
    background-color: #f0f8ff;
    cursor: pointer;
  }

  /* 특정 컬럼 정렬 조정 (예: 아이디는 왼쪽, 날짜는 오른쪽) */
  #board-table td:nth-child(1),
  #board-table td:nth-child(5) {
    text-align: left; /* ID는 왼쪽 정렬 */
  }

  #board-table td:nth-child(7),
  #board-table td:nth-child(8) {
    text-align: right; /* 날짜는 오른쪽 정렬 */
    font-size: 13px;
    color: #555;
  }
</style>